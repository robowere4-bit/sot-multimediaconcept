<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>S.O.T Multimedia Bible Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,sans-serif}
body{background:#111;color:#fff}

/* LOADING */
#loading{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
#loadingLogo{width:80px;height:80px;border-radius:50%;border:4px solid orange;animation:spin 2s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#loadingText{margin:15px 0;color:orange}
#bar{width:260px;height:12px;background:#333;border-radius:20px;overflow:hidden}
#fill{height:100%;width:0;background:linear-gradient(90deg,orange,orangered)}

/* HEADER */
header{display:flex;justify-content:flex-end;align-items:center;padding:15px;background:#000}
header img{width:45px;height:45px;border-radius:50%;border:3px solid orange;animation:spin 6s linear infinite}
header span{margin-left:10px;color:orange;font-weight:bold;animation:blink 1s infinite}
@keyframes blink{50%{opacity:0}}

/* LANDING */
#landing{max-width:900px;margin:auto;padding:30px;text-align:center}
#landing h2{color:orange;margin-bottom:10px}
#landing p{color:#ccc;line-height:1.6;margin-bottom:25px}
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin-bottom:30px}
.gallery img{width:100%;border-radius:15px}
#startBtn{padding:18px 45px;font-size:22px;border:none;border-radius:25px;background:linear-gradient(90deg,orange,orangered);color:#fff;font-weight:bold;cursor:pointer;animation:glow 1.5s infinite alternate}
@keyframes glow{from{box-shadow:0 0 10px orange}to{box-shadow:0 0 30px orangered}}

/* POPUP FORM */
#popup{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:1000}
#form{background:#1b1b1b;padding:25px;border-radius:20px;width:90%;max-width:380px}
#form h3{color:orange;margin-bottom:15px}
#form input,#form select{width:100%;padding:10px;margin-bottom:10px;border:none;border-radius:10px}
#form button{width:100%;padding:12px;border:none;border-radius:12px;background:orange;font-weight:bold}

/* QUIZ */
#quiz{display:none;max-width:800px;margin:30px auto;padding:20px}
#progressWrap{background:#333;border-radius:20px;overflow:hidden;margin-bottom:10px}
#progress{height:10px;width:0;background:linear-gradient(90deg,orange,orangered)}
#timer{text-align:center;color:orange;font-weight:bold;margin-bottom:10px}
.option{background:#1f1f1f;padding:12px;border-radius:12px;margin-bottom:10px;cursor:pointer}
.option:hover{background:#ff7a00}
#nextBtn{width:100%;padding:12px;border:none;border-radius:15px;background:orangered;color:#fff;font-weight:bold}

/* RESULT */
#result{display:none;max-width:900px;margin:auto;padding:40px;text-align:center}
#result h2{color:orange;margin-bottom:10px}
#leaderboard{margin-top:20px;text-align:left}
#leaderboard li{padding:6px 0;color:#ccc}

footer{text-align:center;padding:12px;color:#888;background:#000;margin-top:40px}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loading">
  <img id="loadingLogo" src="samuel.jpg">
  <div id="loadingText">Loading 1%</div>
  <div id="bar"><div id="fill"></div></div>
</div>

<header>
  <img src="logo.png">
  <span>S.O.T Multimedia Concept</span>
</header>

<section id="landing">
  <h2>S.O.T Bible Quiz</h2>
  <p>
    S.O.T Multimedia Concept is a radio & media platform focused on broadcasting,
    presentation skills, and creative studio excellence.
  </p>
  <div class="gallery">
    <img src="studio1.jpg">
    <img src="studio2.jpg">
    <img src="studio3.jpg">
  </div>
  <button id="startBtn">Start Quiz</button>
</section>

<!-- FORM -->
<div id="popup">
  <div id="form">
    <h3>Participant Details</h3>
    <input id="name" placeholder="Full Name">
    <input id="phone" placeholder="Phone Number">
    <select id="gender">
      <option value="">Select Gender</option>
      <option>Male</option>
      <option>Female</option>
    </select>
    <button id="begin">Begin Quiz</button>
  </div>
</div>

<!-- QUIZ -->
<section id="quiz">
  <div id="progressWrap"><div id="progress"></div></div>
  <div id="timer">Time: 20:00</div>
  <h3 id="qText"></h3>
  <div id="options"></div>
  <button id="nextBtn">Next</button>
</section>

<!-- RESULT -->
<section id="result">
  <h2>Quiz Submitted</h2>
  <p>
    We will get back to you as soon as the database calculates your result.
    Come back next Sunday.
  </p>
  <h3 style="margin-top:20px;color:orange">Top Participants</h3>
  <ol id="leaderboard"></ol>
</section>

<footer>© 2026 S.O.T Multimedia Concept</footer>

<script>
/* LOADING */
let lp=1;
const fill=document.getElementById("fill"),txt=document.getElementById("loadingText");
const loading=document.getElementById("loading");
const li=setInterval(()=>{
  lp++; fill.style.width=lp+"%"; txt.textContent="Loading "+lp+"%";
  if(lp>=100){clearInterval(li);loading.style.display="none";}
},20);

/* QUESTIONS (60 TOTAL) */
const questions=[
  // HARD (40)
  ...Array.from({length:40},(_,i)=>({
    q:`Hard Question ${i+1}`,
    o:["Option A","Option B","Option C","Option D"],
    a:Math.floor(Math.random()*4),
    w:2
  })),
  // EASY (20)
  ...Array.from({length:20},(_,i)=>({
    q:`Easy Question ${i+1}`,
    o:["Option A","Option B","Option C"],
    a:0,
    w:1
  }))
];

// shuffle
questions.sort(()=>Math.random()-0.5);

/* QUIZ LOGIC */
let idx=0,score=0,time=1200,timer,active=false,cheated=false;
const quiz=document.getElementById("quiz");
const qText=document.getElementById("qText");
const options=document.getElementById("options");
const progress=document.getElementById("progress");

startBtn.onclick=()=>popup.style.display="flex";

begin.onclick=()=>{
  if(!name.value||!phone.value||!gender.value){alert("Fill all fields");return;}
  popup.style.display="none";
  landing.style.display="none";
  quiz.style.display="block";
  active=true;
  startTimer();
  showQ();
};

function startTimer(){
  timer=setInterval(()=>{
    time--;
    timerEl.textContent=`Time: ${Math.floor(time/60)}:${(time%60+"").padStart(2,"0")}`;
    if(time<=0) finish();
  },1000);
}

function showQ(){
  const q=questions[idx];
  qText.textContent=(idx+1)+"/"+questions.length+" - "+q.q;
  progress.style.width=((idx/questions.length)*100)+"%";
  options.innerHTML="";
  q.o.forEach((t,i)=>{
    options.innerHTML+=`
      <div class="option">
        <label><input type="radio" name="opt" value="${i}"> ${t}</label>
      </div>`;
  });
}

nextBtn.onclick=()=>{
  const s=document.querySelector("input[name=opt]:checked");
  if(!s)return alert("Select an answer");
  if(+s.value===questions[idx].a) score+=questions[idx].w;
  idx++;
  idx>=questions.length?finish():showQ();
};

function finish(){
  clearInterval(timer);
  active=false;
  quiz.style.display="none";
  result.style.display="block";

  const max=questions.reduce((a,q)=>a+q.w,0);
  const percent=Math.round((score/max)*100);

  const ranks=JSON.parse(localStorage.getItem("ranks")||"[]");
  ranks.push({name:name.value,percent});
  ranks.sort((a,b)=>b.percent-a.percent);
  localStorage.setItem("ranks",JSON.stringify(ranks.slice(0,5)));

  leaderboard.innerHTML="";
  ranks.slice(0,5).forEach(r=>{
    leaderboard.innerHTML+=`<li>${r.name} - ${r.percent}%</li>`;
  });

  fetch("/api/send",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name:name.value,phone:phone.value,gender:gender.value,score,percent})
  });
}

/* ANTI-CHEAT */
document.addEventListener("visibilitychange",()=>{
  if(active && document.hidden && !cheated){
    cheated=true;
    alert("⚠️ Tab switch detected. 2 points deducted.");
    score=Math.max(score-2,0);
  }
});
</script>

</body>
</html>
